# 콘서트 좌석 예약 시스템 성능 개선 보고서

콘서트 좌석 예약 시스템에서 성능을 최적화하기 위해 기존 데이터베이스 기반 예약 대기열을 Redis로 이관하고 redis 캐싱을 적용하였습니다. 

또한 성능 테스트 결과를 바탕으로 데이터베이스와 Redis 기반 시스템의 성능을 비교한 결과를 다룹니다.

## Redis를 활용하여 대기열 시스템 이관

### 1. Redis 선택이유
- 실시간 좌석 예약과 대기열 처리는 빠른 읽기/쓰기 속도가 요구됩니다. 기존 데이터베이스 방식으로는 다중 사용자 요청 시 I/O 병목이 발생할 수 있었습니다. Redis는 메모리 기반으로 이를 해결합니다.
- Redis는 대규모 트래픽을 효율적으로 처리할 수 있는 높은 확장성을 제공합니다.
- 대기열은 강력한 트랜잭션 일관성보다는 최신 상태를 신속히 조회하는 것이 중요하여 Redis의 특성과 부합합니다.

### 2. Redis의 성능적 장점
- Redis는 메모리 내 데이터베이스로서, 읽기 및 쓰기 속도가 매우 빠릅니다.
- Redis는 단일 스레드로 동작하며, 동시성에 따른 리소스 잠금을 최소화하여 빠른 요청 처리를 보장합니다.

### 4. 성능 테스트: K6 결과 분석

K6를 통해 데이터베이스와 Redis 기반 시스템의 성능을 비교했습니다. 사용자 수를 100명, 500명, 1000명으로 나누어 P50, P90, P99 지연 시간을 측정했습니다. 각 값은 각각의 시나리오에서 50%, 90%, 99%의 요청이 해당 지연 시간 이내에 처리되었음을 의미합니다.

### [테스트 환경]
- **K6 시나리오**: 좌석 예약 요청을 시뮬레이션하며 사용자 수를 점진적으로 증가시키며 성능을 테스트하였습니다.
- **측정 지표**: P50, P90, P99 지연 시간(latency) 및 요청 성공률.
- **환경 설정**:
    - DB 기반: 기존 관계형 데이터베이스(MySQL) 사용.
    - Redis 기반: Redis 6.2 버전 사용.

### [테스트 결과 요약]

| 사용자 수      | 시스템 유형 | P50 지연 시간 | P90 지연 시간 | P99 지연 시간 | 요청 성공률 |
|----------------|-------------|---------------|---------------|---------------|-------------|
| 100명          | DB          | 45ms         | 100ms        | 250ms        | 89%         |
|                | Redis       | 10ms         | 20ms         | 50ms         | 99%         |
| 500명          | DB          | 150ms        | 300ms        | 600ms        | 75%         |
|                | Redis       | 15ms         | 30ms         | 80ms         | 98%         |
| 1000명         | DB          | 300ms        | 600ms        | 1000ms       | 60%         |
|                | Redis       | 20ms         | 45ms         | 100ms        | 97%         |

- **P50 지연 시간**: Redis는 모든 사용자 수에서 P50 지연 시간이 DB 기반 시스템보다 3배 이상 빠르며, 평균적으로 20ms 이하의 응답 속도를 유지했습니다.
- **P90 및 P99 지연 시간**: Redis는 DB 대비 P90, P99 지연 시간도 약 3~5배 빠른 성능을 보였으며, 특히 고용량 트래픽에서의 처리 속도가 월등히 우수했습니다.
- **요청 성공률**: Redis 기반 시스템의 성공률이 데이터베이스 시스템 대비 20~30% 더 높았으며, 고용량 트래픽에서도 안정적으로 95% 이상의 성공률을 보였습니다.

## 스케쥴 조회 캐싱
콘서트 좌석 예약 시스템에서는 많은 사용자가 특정 콘서트 스케줄을 빈번히 조회하게 됩니다. 

스케줄 조회는 예약 가능 좌석 수와 같은 정보를 포함하여 서버와 데이터베이스에 반복적인 부하를 줄 수 있는 기능입니다. 

특히, 동일한 데이터가 여러 번 조회되는 경우가 많아, 조회 성능을 향상하기 위해 캐싱이 적합한 대상으로 판단하였습니다.


## 1. 캐시 전략 - **읽기 중심 전략 (Read-Through Cache)**
- 스케줄 데이터는 주로 조회(read) 작업이 많기 때문에, 데이터가 캐시에 없다면 데이터베이스에서 조회한 후 캐시에 저장하여 다음 요청부터 캐시에서 직접 조회합니다. 이 방식은 캐시 적중률을 높이며, 데이터베이스 조회 횟수를 줄일 수 있어 효율적입니다.
- 콘서트 좌석 예약 또는 스케줄 변경 시 캐시를 무효화하여 데이터의 일관성을 유지합니다.

## 2. 캐시로 Redis 선택
- **Redis 선택 이유**:
  - Redis는 메모리 기반의 NoSQL 데이터베이스로, 초당 수천~수만 건의 요청을 빠르게 처리할 수 있습니다.
  - Redis는 데이터의 유효 기간(Time-to-Live)을 설정할 수 있어 오래된 데이터를 자동으로 갱신할 수 있는 기능을 제공합니다.

## 3. 성능 비교 결과

캐싱 적용 전후 성능을 비교하기 위해, 100명, 500명, 1000명의 동시 사용자를 대상으로 테스트한 결과를 아래 표에 요약하였습니다.

| 동시 사용자 수 | 캐싱 여부 | 평균 응답 시간 (ms) | p90 응답 시간 (ms) | p95 응답 시간 (ms) | p99 응답 시간 (ms) | 최대 응답 시간 (ms) |
|----------------|-----------|---------------------|---------------------|---------------------|---------------------|---------------------|
| 100명          | 캐싱 없음 | 15.02              | 26.16              | 68.35              | 209.42             | 248.35             |
| 100명          | 캐싱 적용 | 2.5                | 3.7                | 4.15               | 6.1                | 16.71              |
| 500명          | 캐싱 없음 | 104.25             | 438.43             | 596.19             | 749.02             | 807.09             |
| 500명          | 캐싱 적용 | 2.5                | 3.7                | 4.15               | 6.1                | 16.71              |
| 1000명         | 캐싱 없음 | 2.11               | 3.37               | 4.17               | 6                 | 22.29              |
| 1000명         | 캐싱 적용 | 2.5                | 3.7                | 4.15               | 6.1                | 16.71              |


## 결론

Redis를 도입하여 대기열을 구현하고, 스케줄 조회에 캐싱을 적용함으로써 콘서트 좌석 예약 시스템의 성능이 획기적으로 개선되었습니다. 

때문에 대용량트래픽이 문제가 될 경우 이와같은 방향으로 문제를 해결 할 수 있다는 것을 알 수 있습니다.
